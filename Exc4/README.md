# Логирование

## Мотивация

Внедрение логирования позволит компании «Александрит» детализировать информацию о событиях внутри системы, что поможет в анализе и устранении ошибок, улучшении пользовательского опыта и повышении безопасности. Логирование поддерживает прозрачность операций и облегчает диагностику проблем.

Технические и бизнес-метрики, на которые влияет логирование:
1. Скорость обнаружения ошибок: Быстрое выявление и устранение ошибок.
2. Производительность системы: Оптимизация процессов через анализ логов.
3. Безопасность данных: Выявление и предотвращение несанкционированного доступа.
4. Скорость обработки заказов: Уменьшение задержек через анализ логов.
5. Удовлетворенность клиентов: Повышение качества обслуживания за счет точной диагностики проблем.

### Логи, которые нужно собирать

INFO уровень:

1. Изменение статуса заказа
   - Время, идентификатор покупателя, номер заказа.

2. Создание и обновление заказа
   - Время, идентификатор покупателя, номер заказа, детали обновления.

3. API запросы и ответы
   - Время запроса, тип запроса, статус ответа, идентификатор сессии.

4. Обработка сообщений в RabbitMQ
   - Время обработки, тип сообщения, идентификатор сообщения.

5. Доступ к хранилищу 3D-файлов
   - Время доступа, тип операции, идентификатор файла.

Другие уровни логирования:

- ERROR: Ошибки, которые требуют немедленного вмешательства.
- DEBUG: Подробная информация для разработки, включается при необходимости.

### Приоритет логирования и трейсинга

- Первоначальные системы для логирования и трейсинга:
  - CRM API и MES API: Эти системы критичны для обработки заказов и их задержек.
  - RabbitMQ интеграция: Для обеспечения надежной передачи сообщений.

### Предлагаемое решение

Технологии для логирования:
- Elastic Stack (ELK): Elasticsearch для хранения, Logstash для обработки, Kibana для визуализации.

Компоненты для внедрения:
- Агенты логирования в каждый ключевой сервис.
- Централизованный сервер для сбора и обработки логов.

Политика безопасности:
- Доступ: Только сотрудники с ролью «Поддержка» имеют доступ к логам.
- Обработка чувствительных данных: Маскирование или исключение личных данных из логов.

Политика хранения:
- Хранение логов в отдельном индексе для каждой системы.
- Срок хранения: 30 дней, с возможностью архивирования.
- Ограничение размера логов для предотвращения переполнения.

Анализ логов:
- Алертинг: Настройка уведомлений о критических ошибках и аномалиях.
- Поиск аномалий: Выявление подозрительной активности, например, резкое увеличение числа заказов.

### Критерии для выбора технологии

1. Масштабируемость
   - Плюсы: Поддержка роста компании без ухудшения производительности.
   - Минусы: Некоторые технологии могут требовать значительных ресурсов.

2. Интеграция
   - Плюсы: Простота интеграции с существующими системами.
   - Минусы: Проблемы совместимости с проприетарными системами.

3. Удобство использования
   - Плюсы: Простота настройки и использования.
   - Минусы: Могут потребоваться значительные усилия для обучения команды.

4. Безопасность
   - Плюсы: Возможность защиты и контроля доступа к логам.
   - Минусы: Некоторые решения могут иметь уязвимости.

5. Стоимость
   - Плюсы: Возможность оптимизации затрат.
   - Минусы: Высокая стоимость лицензий и внедрения для некоторых решений.
